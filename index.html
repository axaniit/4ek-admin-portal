<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>4EK Ambassador Portal</title>

  <!-- ===== 4EK Ambassador Portal Login (NETLIFY REDIRECT VERSION) ===== -->
  <meta name="robots" content="noindex, nofollow">

  <!-- Theme (fake WP look) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/portal-theme.css">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="robots" content="noindex, nofollow">

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Theme CSS -->
  <link rel="stylesheet" href="assets/portal-theme.css?v=8">

  <!-- HARD PROOF OVERRIDES (remove later if you want) -->
  <style>
    body{ font-family:"Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important; }
    .portal-hero{ background: linear-gradient(90deg,#b88f2c,#c8a64b) !important; }
  </style>


  <!-- Login-specific tweaks -->
  <style>
    /* If your theme sets global body padding, this keeps it clean */
    body{ margin:0; }

    /* Login box uses your existing styles but aligns to theme */
    .field{display:block;margin:10px 0 12px;}
    .input{width:100%;padding:10px 12px;border:1px solid #cfcfcf;border-radius:8px;margin-top:6px;box-sizing:border-box;}
    .btn{width:100%;padding:12px;border:0;border-radius:8px;background:#111;color:#fff;cursor:pointer;font-weight:900;letter-spacing:.4px;text-transform:uppercase}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .hint{font-size:12px;color:#666;margin-top:6px;line-height:1.35}
    .hidden{display:none}
    a{color:#111}

    /* Center area under hero like the old page */
    .login-wrap{ max-width: 980px; margin: 0 auto; padding: 22px 16px 48px; }
    #box{ margin: 18px auto 0 !important; }

    /* Make login look closer to your old gold button vibe (optional) */
    /* Uncomment if you want CONTINUE to be gold instead of black */
    /*
    .btn{
      background: linear-gradient(90deg, #b88f2c, #c8a64b);
      color:#111;
      box-shadow: 0 3px 0 rgba(0,0,0,.20);
    }
    */
  </style>
</head>

<body>
  <!-- Fake WP-style header + hero -->
  <header class="ucf-topbar">
    <div class="ucf-topbar__inner">
      <div class="ucf-brand">
        <div class="ucf-brand__badge">UCF Alumni</div>
        <div class="ucf-brand__sub">UNIVERSITY OF CENTRAL FLORIDA</div>
      </div>

      <nav class="ucf-nav" aria-label="Primary">
        <a href="#" class="ucf-nav__link">GET INVOLVED</a>
        <a href="#" class="ucf-nav__link">EVENTS</a>
        <a href="#" class="ucf-nav__link">GIVE TO UCF</a>
        <a href="#" class="ucf-nav__link">ALUMNI BLOG</a>
        <a href="#" class="ucf-nav__link">ALUMNI CENTER</a>
        <a href="#" class="ucf-nav__link">ABOUT US</a>
      </nav>

      <div class="ucf-topbar__right">
        <div class="ucf-search">
          <input class="ucf-search__input" type="search" placeholder="Search UCF" aria-label="Search UCF">
          <button class="ucf-search__btn" type="button">SEARCH</button>
        </div>
      </div>
    </div>
    <div class="ucf-topbar__goldline"></div>
  </header>

  <section class="portal-hero">
    <h1>4EK Ambassador Portal</h1>
  </section>
  <div class="portal-accent-line"></div>

  <main class="login-wrap">
    <div id="box" style="max-width:460px;margin:24px auto;padding:18px;border:1px solid #e2e2e2;border-radius:12px;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.06)">
      <h2 style="margin:0 0 6px;">4EK Ambassador Portal</h2>
      <p style="color:#666;margin:0 0 14px;">Login with UCF Email</p>

      <div id="msg" class="hint hidden" style="margin-bottom:12px;"></div>

      <form id="stepLogin">
        <label class="field">UCF Email
          <input id="email" type="email" class="input" placeholder="you@ucf.edu" required autocomplete="username">
        </label>
        <label class="field">Password
          <input id="password" type="password" class="input" autocomplete="current-password">
        </label>
        <button class="btn" id="btnLogin" type="submit">Continue</button>
      </form>
    </div>
  </main>

  <script>
  /* ===== CONFIG ===== */
  const API = "https://script.google.com/macros/s/AKfycbxUUnLnZWfYGe0ZJ5NKtoLXa78qXCK-cEeCv2Ip_3Xm_XUDy-fFp-w0gShBxakcjJdCPg/exec";
  const SESSION_KEY = "portal_session_v1";

  /* ðŸ”¥ HARD-CODED NETLIFY DESTINATION */
  const NETLIFY_BASE = "https://cool-tarsier-9bfafd.netlify.app";

  /* ===== UTIL ===== */
  const $ = (id) => document.getElementById(id);

  function setMsg(t, ok=false){
    const el = $("msg");
    el.classList.remove("hidden");
    el.style.color = ok ? "#1a7f37" : "#b00020";
    el.textContent = t;
  }
  function hideMsg(){ $("msg").classList.add("hidden"); $("msg").textContent=""; }

  function saveSession(username, role){
    const payload = { username, role, ts: Date.now() };
    localStorage.setItem(SESSION_KEY, JSON.stringify(payload));
  }

  function redirectToPortal(role){
    const target = role === "admin"
      ? NETLIFY_BASE + "/admin.html"
      : NETLIFY_BASE + "/student.html";

    console.log("FORCING redirect to:", target);
    window.location.href = target; // hard nav
  }

  /* ===== API ===== */
  async function POST_LOGIN(email, password){
    const qs = new URLSearchParams({
      action: "login",
      student_id: email,
      email: email,
      username: email
    }).toString();

    const url = API + "?" + qs;

    const r = await fetch(url, {
      method: "POST",
      mode: "cors",
      cache: "no-cache",
      body: JSON.stringify({
        student_id: email,
        email: email,
        username: email,
        password: password
      })
    });

    const t = await r.text();
    try { return JSON.parse(t); }
    catch { return { ok:false, error:"Invalid JSON", body:t }; }
  }

  /* ===== LOGIN ===== */
  $("stepLogin").addEventListener("submit", async (e)=>{
    e.preventDefault();
    hideMsg();

    const email = ($("email").value || "").trim().toLowerCase();
    const password = $("password").value || "";

    if(!email){ setMsg("Enter your UCF email."); return; }
    if(!password){ setMsg("Enter your password."); return; }

    $("btnLogin").disabled = true;
    $("btnLogin").textContent = "Loadingâ€¦";

    try{
      localStorage.removeItem(SESSION_KEY);

      const out = await POST_LOGIN(email, password);
      console.log("LOGIN response:", out);

      if(out?.ok && out.role){
        saveSession(email, out.role);
        redirectToPortal(out.role);
        return;
      }

      if(out?.status === "bad_password"){
        setMsg("Incorrect password.");
      } else if(out?.error){
        setMsg("Login failed: " + out.error);
      } else {
        setMsg("Login failed.");
      }

    }catch(err){
      console.error("Login error:", err);
      setMsg("Could not reach login service.");
    }

    $("btnLogin").disabled = false;
    $("btnLogin").textContent = "Continue";
  });
  </script>
</body>
</html>
